---
layout: post
title: Разбираемся с проблемами WMI
---

В работе так случается, что показания диагностики не выдают какие-то значения. Так как основной поставщик данных состояния Windows является WMI, то будем разбираться, что и как влияет.

Основные проблемы связаны чаще всего с тем, что пропадают/отсутствуют нужные "сигналы" в дереве.
Для его проверки можно использовать:

* [WMI Code Creator](https://www.microsoft.com/en-us/download/details.aspx?id=8572):
* Сделать запрос через командную строку - `wmic /?`

За WMI отвечает служба "Инструментарий управления Windows" - перезапуск может помочь.

Если некоторые счетчики отсутствуют или не содержат встречных данных - значит проверяем работу базы счетчиков. Проверить их можно через утилиту perfmon - при открытии приложения выйдет ошибка. На сайте Microsoft есть хорошая статья по этому поводу - [ссылка](https://docs.microsoft.com/ru-ru/troubleshoot/windows-server/performance/manually-rebuild-performance-counters). По своему опыту в данном случае могу сразу сказать:

* Проверяйте пути в реестре: `HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\` и `HKEY_LOCAL_MACHINE\Software\Microsoft\WindowsNT\CurrentVersion\Perflib\009`
* Если по путям выше ничего нету - запускайте ребилд через команду `lodctr /R` (как собственно и говориться в статье Microsoft).

Так же есть одна хорошая статья про использование [WMIDiag](https://winitpro.ru/index.php/2014/08/12/ustranenie-nepoladok-v-wmi/), а так же ссылка на скачивание самого скрипта: [WMIDiag.vbs - The WMI Diagnosis Utility](https://gist.github.com/eladkarako/866e6d044d3b88c200561384bce44c52). Исходя из своего опыта, данный скрипт мне не помог, когда я столкнулся с одной из проблем (временное решение - перезапуск службы помогает, но почему служба не выдает данные по WMI я так и не выяснил).